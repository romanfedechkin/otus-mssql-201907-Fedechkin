--1.Выберите сотрудников, которые являются продажниками, и еще не сделали ни одной продажи.
/****** Скрипт для команды SelectTopNRows из среды SSMS  ******/
select [PersonID]
	,[fullname]
	,[issalesperson]
from [application].[people] a
where [issalesperson] not in (Select distinct salespersonpersonid from [sales].[Invoices])
and [issalesperson] = 1

--
with a as (select distinct salespersonpersonid from [sales].[Invoices])
select [PersonID]
	,[fullname]
	,[issalesperson]
	from [application].[people] b
	where b.IsSalesperson not in (select * from a)
	and [issalesperson] = 1
--2
select [stockitemname]
from [Warehouse].[StockItems]
where UnitPrice in (select min(unitprice) from [Warehouse].[StockItems])

select [stockitemname]
from [Warehouse].[StockItems] s2
group by [stockitemname]
having min(unitprice) = (select min(unitprice) from [Warehouse].[StockItems])

--3
select distinct 
 s.[Customerid]
,s.[Customername]
from [Sales].[Customers] s
where s.[Customerid] in 
(select top (5) Customerid from [Sales].[CustomerTransactions] order by [TransactionAmount] desc)

WITH tmp ([Customerid]) as
( select top (5) cc.Customerid 
from [Sales].[CustomerTransactions] cc
 order by [TransactionAmount] desc)
 select  c.[Customerid]
       ,c.[Customername]
from [Sales].[Customers] c
join tmp on c.CustomerID = tmp.Customerid

select distinct 
 c.[Customerid]
,c.[Customername]
from [Sales].[CustomerTransactions] cc
join [Sales].[Customers] c
on cc.CustomerID = c.CustomerID
where TransactionAmount in 
(select top (5) TransactionAmount 
from [Sales].[CustomerTransactions] 
order by [TransactionAmount] desc)

--3
select distinct 
 s.[Customerid]
,s.[Customername]
from [Sales].[Customers] s
where s.[costumerid] in 
(select top (5) Customerid from [Sales].[CustomerTransactions] order by [TransactionAmount] desc)

WITH tmp ([Customerid]) as
( select top (5) cc.Customerid 
from [Sales].[CustomerTransactions] cc
 order by [TransactionAmount] desc)
 select  c.[Customerid]
       ,c.[Customername]
from [Sales].[Customers] c
join tmp on c.CustomerID = tmp.Customerid

select distinct 
 c.[Customerid]
,c.[Customername]
from [Sales].[CustomerTransactions] cc
join [Sales].[Customers] c
on cc.CustomerID = c.CustomerID
where TransactionAmount in 
(select top (5) TransactionAmount 
from [Sales].[CustomerTransactions] 
order by [TransactionAmount] desc)

select distinct 
	cit.cityid,
	cit.cityndme,
	p.fullname,
	il.unitprice
from sales.Invoices si 
join sales.InvoiceLines il on si.InvoiceID = sil.InvoiceID
join Application.People p on si.PackedByPersonID= ap.PersonID
join sales.Customers cus  on si.CustomerID = cus.CustomerID 
join Application.Cities cit on cit.sityid = cus.DeliveryCityID
where il.UnitPrice in (select top(3) UnitPrice from [Warehouse].StockItems order by unitprice desc
select distinct 
 s.[Customerid]
,s.[Customername]
from [Sales].[Customers] s
where s.[costumerid] in 
(select top (5) Customerid from [Sales].[CustomerTransactions] order by [TransactionAmount] desc)

WITH tmp ([Customerid]) as
( select top (5) cc.Customerid 
from [Sales].[CustomerTransactions] cc
 order by [TransactionAmount] desc)
 select  c.[Customerid]
       ,c.[Customername]
from [Sales].[Customers] c
join tmp on c.CustomerID = tmp.Customerid

select distinct 
 c.[Customerid]
,c.[Customername]
from [Sales].[CustomerTransactions] cc
join [Sales].[Customers] c
on cc.CustomerID = c.CustomerID
where TransactionAmount in 
(select top (5) TransactionAmount 
from [Sales].[CustomerTransactions] 
order by [TransactionAmount] desc)

select distinct 
	cit.cityid,
	cit.cityndme,
	p.fullname,
	il.unitprice
from sales.Invoices si 
join sales.InvoiceLines il on si.InvoiceID = sil.InvoiceID
join Application.People p on si.PackedByPersonID= ap.PersonID
join sales.Customers cus  on si.CustomerID = cus.CustomerID 
join Application.Cities cit on cit.sityid = cus.DeliveryCityID
where il.UnitPrice in (select top(3) UnitPrice from [Warehouse].StockItems order by unitprice desc




